    -- This query runs against the provided global temp table to discover all unique column combinations.
    DECLARE @columnListSql NVARCHAR(MAX) = N'
        SELECT @result = STRING_AGG(DISTINCT QUOTENAME(PivotColumn), '','')
        FROM (
            SELECT ' + @pivotColumnConstructor + N' AS PivotColumn
            FROM ' + @GlobalTempTableName + N' s
            CROSS APPLY (' + @unpivotClause + N') AS m(MeasureName, MeasureValue)
        ) AS DistinctColumns;';
    EXEC sp_executesql @columnListSql, N'@result NVARCHAR(MAX) OUTPUT', @result = @pivotColumns OUTPUT;
>>>Generates the below invalid sql. Error is: Incorrect syntax near ','.Incorrect syntax near the keyword 'AS'.

SELECT @result = STRING_AGG(DISTINCT QUOTENAME(PivotColumn), ',')
        FROM (
            SELECT CONCAT(s.[Value1], '_', s.[Value2], '_', s.[Value3], '_', m.MeasureName) AS PivotColumn
            FROM ##TestRaw s
            CROSS APPLY (VALUES ('RateValue', s.[RateValue]), ('VariableValue', s.[VariableValue])) AS m(MeasureName, MeasureValue)
        ) AS DistinctColumns;
